
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using Craigslist to compare prices in the Bay Area &#8212; blog  documentation</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.e00ebc5fe59cde01733db895d987848c.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.88dc4f4c5bd3676d55da.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
  
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  
  <link rel="alternate" type="application/atom+xml"  href="../../../blog/atom.xml" title="Predictably Noisy">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../../../">
      <img src="../../../_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../about/">About me</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../projects/">Projects</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../publications/">Publications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../blog/">Blog</a>
        </li>
        
        
      </ul>


      <form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" >
</form>
      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/choldgraf/" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/choldgraf" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">
  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    27 September 2015
  
  </h2>

  <ul>
    

  

  

  

  
  <li id="category"><span><i class="fa-fw fa fa-folder-open"></i></span>
    
      
      <a href="../../../blog/category/computation/">computation</a>
      
    </li>
  

  
  <li id="tags"><span><i class="fa-fw fa fa-tags"></i>
      </span>
    
      
      <a href="../../../blog/tag/python/">python</a>
      
    
      
      <a href="../../../blog/tag/scraping/">scraping</a>
      
    
      
      <a href="../../../blog/tag/data-analysis/">data analysis</a>
      
    
      
      <a href="../../../blog/tag/visualization/">visualization</a>
      
    </li>
  
  
  <li id="comments">
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'chrisholdgraf'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/posts/2015/2015-09-27-craigslist_data_analysis/"> </a>
  </li>
  
  </ul>

  <h3><a href="../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../2020/2020-01-22-rst-thoughts/">22 January - What do people think about rST?</a></li>
    
      <li><a href="../../2019/2019-11-11-ipynb_pandoc/">11 November - Testing Pandoc and Jupyter Notebooks</a></li>
    
      <li><a href="../../2019/2019-10-27-jupyter-governance-python/">27 October - What would Python-style governance look like in Jupyter?</a></li>
    
      <li><a href="../../2019/2019-10-22-xarray-neuro/">22 October - Analyzing intracranial electrophysiology data with xarray</a></li>
    
      <li><a href="../../2019/2019-10-13-rust-jupyter-governance/">13 October - What would Rust-style governance look like in Jupyter?</a></li>
    
  </ul>

  <h3><a href="../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../blog/2020/">2020 (1)</a></li>
    
  
    
    <li><a href="../../../blog/2019/">2019 (8)</a></li>
    
  
    
    <li><a href="../../../blog/2018/">2018 (1)</a></li>
    
  
    
    <li><a href="../../../blog/2017/">2017 (3)</a></li>
    
  
    
    <li><a href="../../../blog/2016/">2016 (6)</a></li>
    
  
    
    <li><a href="../../../blog/2015/">2015 (4)</a></li>
    
  
  </ul>

          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#" class="nav-link">Using Craigslist to compare prices in the Bay Area</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#price-distributions" class="nav-link">Price distributions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#text-analysis" class="nav-link">Text analysis</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#so-what-have-we-learned" class="nav-link">So what have we learned?</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="using-craigslist-to-compare-prices-in-the-bay-area">
<h1>Using Craigslist to compare prices in the Bay Area<a class="headerlink" href="#using-craigslist-to-compare-prices-in-the-bay-area" title="Permalink to this headline">Â¶</a></h1>
<p>In the <a class="reference external" href="http://chrisholdgraf.com/querying-craigslist-with-python/">last post</a> I showed how to use a simple python bot to scrape data from Criagslist. This is a quick follow-up to take a peek at the data.</p>
<blockquote>
<div><p>Note - data that you scrape from Craigslist is pretty limited. They tend to clear out old posts, and you can only scrape from recent posts anyway to avoid them blocking you.</p>
</div></blockquote>
<p>Now that weâve got some craigslist data, what questions can we ask? Well, a good start would be to see where we want (or donât want) to rent our house. Letâs compare the housing market in a few different regions of the Bay Area.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seaborn can help create some pretty plots</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s1">&#39;colorblind&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First we&#39;ll load the data we pulled from before</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/craigslist_results.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="price-distributions">
<h1>Price distributions<a class="headerlink" href="#price-distributions" title="Permalink to this headline">Â¶</a></h1>
<p>As a start, letâs take a look at the distribution of home prices to get an idea for what weâre dealing with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-09-27-craigslist_data_analysis_4_1.png" src="../../../_images/2015-09-27-craigslist_data_analysis_4_1.png" />
</div>
</div>
<p>Thatâs not super useful - it looks like we have a highly skewed distribution with a few instances way out to the right. Weâll convert to a log scale from here on to make it easier to comprehend:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;logprice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;logprice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Log plots are nicer for skewed data&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.text.Text at 0x1141cb690&gt;]
</pre></div>
</div>
<img alt="../../../_images/2015-09-27-craigslist_data_analysis_6_1.png" src="../../../_images/2015-09-27-craigslist_data_analysis_6_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t forget the log mappings:</span>
<span class="nb">print</span><span class="p">([</span><span class="s1">&#39;10**</span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()])</span>
</pre></div>
</div>
</div>
</div>
<p>However, what we really want is to look at the breakdown of prices for a few locations in the bay area. Luckily Craigslist stores this in the URL of our search, so we can easily split this up with a pandas <code class="docutils literal notranslate"><span class="pre">groupby</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax_hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;logprice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;San Francisco is too damn expensive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-09-27-craigslist_data_analysis_9_0.png" src="../../../_images/2015-09-27-craigslist_data_analysis_9_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()[</span><span class="s1">&#39;logprice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">summary</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="s1">+/-</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Differences on the order of: $&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mf">3.65</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**</span><span class="mf">3.4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Thatâs a bit unsurprising - San Francisco is significantly more expensive than any other region in the area. Note that this is a log scale, so small differences at this scale == large differences in the raw values.</p>
<p>However, it looks like the shapes of these prices are different as well. If any of these distributions arenât symmetric around the center, then describing it with the mean +/- standard deviation isnât so great.</p>
<p>Perhaps a better way to get an idea for what kind of deal weâre getting is to directly calculate price per square foot. Letâs see how this scales as the houses go up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;ll quickly create a new variable to use here</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;ppsf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These switches will turn on/off the KDE vs. histogram</span>
<span class="n">kws_dist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">n_loc</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_ppsf</span><span class="p">,</span> <span class="n">ax_sze</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;ppsf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_ppsf</span><span class="p">,</span>
                 <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="o">**</span><span class="n">kws_dist</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_sze</span><span class="p">,</span>
                 <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="o">**</span><span class="n">kws_dist</span><span class="p">)</span>
<span class="n">ax_ppsf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Price per square foot&#39;</span><span class="p">)</span>
<span class="n">ax_sze</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Size&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.text.Text at 0x114f59090&gt;]
</pre></div>
</div>
<img alt="../../../_images/2015-09-27-craigslist_data_analysis_13_1.png" src="../../../_images/2015-09-27-craigslist_data_analysis_13_1.png" />
</div>
</div>
<p>So it looks like size-wise, there arenât many differences here. However, with price per square foot, youâll be paying a lot more for the same space in SF.</p>
<p>Finally, letâs take a look at how the price scales with the size. For this, weâll use a <code class="docutils literal notranslate"><span class="pre">regplot</span></code> to fit a line to each distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split up by location, then plot summaries of the data for each</span>
<span class="n">n_loc</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_loc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">n_loc</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">vals</span><span class="p">),</span> <span class="p">(</span><span class="n">axr</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">),</span> <span class="n">axs</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;ppsf&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;ppsf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                 <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">axr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Location: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">))</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">002</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-09-27-craigslist_data_analysis_15_0.png" src="../../../_images/2015-09-27-craigslist_data_analysis_15_0.png" />
</div>
</div>
<p>And now on top of one another</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">locs</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;ppsf&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="o">.</span><span class="mi">3</span><span class="p">})</span>

<span class="c1"># If we want to turn off the scatterplot</span>
<span class="n">scats</span> <span class="o">=</span> <span class="p">[</span><span class="n">isct</span> <span class="k">for</span> <span class="n">isct</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">collections</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">isct</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PathCollection</span><span class="p">)]</span>
<span class="c1"># plt.setp(scats, visible=False)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0, 10)
</pre></div>
</div>
<img alt="../../../_images/2015-09-27-craigslist_data_analysis_17_1.png" src="../../../_images/2015-09-27-craigslist_data_analysis_17_1.png" />
</div>
</div>
<p>Basically, lines that go down more steeply mean you get a better deal the bigger the place is.</p>
<p>For instance, if youâre in the southbay you might be paying $6/sqf for a 600 sq. ft. place, but $1/sqf for a 2000 sq. ft. place. On the other hand, San Francisco is pretty consistent, with a relatively flat line. This means that youâll be paying pretty much the same per square foot regardless of how big your place is. In fact, all of the other regions seem to follow the same trend - so if youâre looking for more efficient big-place finds, go with the South Bay.</p>
<p>Also note that this gives us information about the uncertainty in these estimates. The error bars are so wide for San Francisco because we donât have many data points at high values (because there arenât that many places &gt;2000 square feet in SF). Itâs anyoneâs guess as to what this would cost.</p>
</div>
<div class="section" id="text-analysis">
<h1>Text analysis<a class="headerlink" href="#text-analysis" title="Permalink to this headline">Â¶</a></h1>
<p>Finally, we can also learn a bit from the text in the post titles. We could probably get better information by using the post text itself, but this would require some extra legwork looking up the URL of each entry and pulling the body of text from this. Weâll stick with titles for now.</p>
<p>To do this, weâll use some text analysis tools in <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>. This is good enough for our purposes, though if we wanted to do something fancier we could use something like <code class="docutils literal notranslate"><span class="pre">gensim</span></code>, <code class="docutils literal notranslate"><span class="pre">word2vec</span></code>, or <code class="docutils literal notranslate"><span class="pre">nltk</span></code>. (weâd also probably need a lot more data).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">StratifiedShuffleSplit</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.stop_words</span> <span class="kn">import</span> <span class="n">ENGLISH_STOP_WORDS</span>
<span class="kn">import</span> <span class="nn">string</span>
</pre></div>
</div>
</div>
</div>
<p>First weâll do some quick data cleaning - weâll only keep datapoints with a title, and then define some characters to remove so that the definition of âa wordâ makes more sense.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">word_data</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>

<span class="c1"># Remove special characters</span>
<span class="n">rem</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s1">&#39;/\-+.&#39;</span>
<span class="n">rem_chars</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rem</span><span class="p">])</span>
<span class="n">word_data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">word_data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">rem_chars</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, weâll remove words that are too specific (from a geographical standpoint) to the regions weâre using. Otherwise youâll just get a bunch of clusters with streetnames etc. predicting the Bay Area region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loc_words</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eby&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;antioch&#39;</span><span class="p">,</span> <span class="s1">&#39;berkeley&#39;</span><span class="p">,</span> <span class="s1">&#39;dublin&#39;</span><span class="p">,</span> <span class="s1">&#39;fremont&#39;</span><span class="p">,</span> <span class="s1">&#39;rockridge&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;livermore&#39;</span><span class="p">,</span> <span class="s1">&#39;mercer&#39;</span><span class="p">,</span> <span class="s1">&#39;ramon&#39;</span><span class="p">],</span>
             <span class="s1">&#39;nby&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sausalito&#39;</span><span class="p">,</span> <span class="s1">&#39;marin&#39;</span><span class="p">,</span> <span class="s1">&#39;larkspur&#39;</span><span class="p">,</span> <span class="s1">&#39;novato&#39;</span><span class="p">,</span> <span class="s1">&#39;petaluma&#39;</span><span class="p">,</span> <span class="s1">&#39;bennett&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;tiburon&#39;</span><span class="p">,</span> <span class="s1">&#39;sonoma&#39;</span><span class="p">,</span> <span class="s1">&#39;anselmo&#39;</span><span class="p">,</span> <span class="s1">&#39;healdsburg&#39;</span><span class="p">,</span> <span class="s1">&#39;rafael&#39;</span><span class="p">],</span>
             <span class="s1">&#39;sby&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;campbell&#39;</span><span class="p">,</span> <span class="s1">&#39;clara&#39;</span><span class="p">,</span> <span class="s1">&#39;cupertino&#39;</span><span class="p">,</span> <span class="s1">&#39;jose&#39;</span><span class="p">],</span>
             <span class="s1">&#39;scz&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aptos&#39;</span><span class="p">,</span> <span class="s1">&#39;capitola&#39;</span><span class="p">,</span> <span class="s1">&#39;cruz&#39;</span><span class="p">,</span> <span class="s1">&#39;felton&#39;</span><span class="p">,</span> <span class="s1">&#39;scotts&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;seabright&#39;</span><span class="p">,</span> <span class="s1">&#39;soquel&#39;</span><span class="p">,</span> <span class="s1">&#39;westside&#39;</span><span class="p">,</span> <span class="s1">&#39;ucsc&#39;</span><span class="p">],</span>
             <span class="s1">&#39;sfc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;miraloma&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;usf&#39;</span><span class="p">,</span> <span class="s1">&#39;ashbury&#39;</span><span class="p">,</span> <span class="s1">&#39;marina&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;mission&#39;</span><span class="p">,</span> <span class="s1">&#39;noe&#39;</span><span class="p">]}</span>

<span class="c1"># We can append these to sklearn&#39;s collection of english &quot;stop&quot; words</span>
<span class="n">rand_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">,</span> <span class="s1">&#39;xs&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;bd&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="s1">&#39;bdr&#39;</span><span class="p">]</span>
<span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">loc_words</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">rand_words</span>
<span class="n">stop_words</span> <span class="o">=</span> <span class="n">ENGLISH_STOP_WORDS</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">stop_words</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we will vectorize this data so that it can be used with sklearn algorithms. This takes a list of âbagsâ of words, and turns it into a list of vectors, where the length of each vector is the total number of words weâve got. Each position of the vector corresponds to 1 word. It will be â1â if that word is present in the current item, and 0 otherwise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">max_df</span><span class="o">=.</span><span class="mi">6</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">stop_words</span><span class="p">)</span>
<span class="n">vec_tar</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">word_data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">vec_tar</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">word_data</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">counts</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Each row is a post, with 1s representing presence of a word in that post&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-09-27-craigslist_data_analysis_26_1.png" src="../../../_images/2015-09-27-craigslist_data_analysis_26_1.png" />
</div>
</div>
<p>Letâs do a quick description of the most common words in each region. We can use our vectorized vocabulary and see which words were most common.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_words</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">itrg</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">vec_tar</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="n">itrg</span><span class="p">]</span>
    <span class="c1"># Pull only the data points assigned to the current loction</span>
    <span class="n">icounts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">targets</span> <span class="o">==</span> <span class="n">itrg</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    
    <span class="c1"># Which counts had at least five occurrences</span>
    <span class="n">msk_top_words</span> <span class="o">=</span> <span class="n">icounts</span> <span class="o">&gt;</span> <span class="mi">5</span>
    
    <span class="c1"># The inverse transform turns the vectors back into actual words</span>
    <span class="n">top_words</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">msk_top_words</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Then, weâll print the words that are unique to each area by filtering out ones that are common across locations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unique_words</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">top_words</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">others</span> <span class="o">=</span> <span class="n">top_words</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">others</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
    <span class="n">unique_words</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrd</span> <span class="k">for</span> <span class="n">wrd</span> <span class="ow">in</span> <span class="n">top_words</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>
                         <span class="k">if</span> <span class="n">wrd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">others</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
<span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">unique_words</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="se">\n\n</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">words</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Apparently people in the North Bay like appliances, people in Santa Cruz like the beach, people in the East Bay need the Bart, and people in San Francisco have victoriansâ¦who knew.</p>
<p>Just for fun weâll also do a quick classification algorithm to see if some machine learning can find structure in these words that separates one location from another:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">(</span><span class="n">C</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedShuffleSplit</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span>

<span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tr</span><span class="p">,</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">cv</span><span class="p">:</span>
    <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">tr</span><span class="p">],</span> <span class="n">targets</span><span class="p">[</span><span class="n">tr</span><span class="p">])</span>
    <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">tt</span><span class="p">],</span> <span class="n">targets</span><span class="p">[</span><span class="n">tt</span><span class="p">]))</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Doesnât look like it (those are horrible generalization scores), but weâll look at what coefficients it considered important anyway:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">icoef</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vec_tar</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span> <span class="n">coefs</span><span class="p">):</span>
    <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">icoef</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
    <span class="n">important</span> <span class="o">=</span> <span class="n">icoef</span> <span class="o">&gt;</span> <span class="n">cut</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">vec</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">important</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>You may note that these are quite similar to the words that were unique to each location as noted above - such is the power of machine learning :)</p>
<div class="section" id="so-what-have-we-learned">
<h2>So what have we learned?<a class="headerlink" href="#so-what-have-we-learned" title="Permalink to this headline">Â¶</a></h2>
<p>Well, you might say that weâve merely quantified what everybody already knows: San Francisco is expensive, really expensive. If youâre looking for a place in the Bay Area, you can expect to shell out a lot more for the same square footage.</p>
<p>However, whatâs also interesting is that apartments in the Bay Area donât seem to obey the same rules that other regions do - they donât necessarily become more economically efficient as the place gets bigger. This is in stark contrast to the south bay, where places are pretty expensive in general, but in ways that youâd expect for an apartment.</p>
<p>Finally, there are probably lots of other cool things that you could do with these datasets, especially if you wanted to break things down by neighborhood and collect more data.</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../2015-08-30-craigslist_scrape/">
    <i class="fa fa-arrow-circle-left"></i>
    Scraping craigslist
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../2015-10-29-nih_grant_analysis/">
    NIH grant analysis
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  
  </span>
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'chrisholdgraf';
        var disqus_identifier = '/posts/2015/2015-09-27-craigslist_data_analysis/';
        var disqus_title = 'Using Craigslist to compare prices in the Bay Area';
        var disqus_url = 'https://predictablynoisy.com/posts/2015/2015-09-27-craigslist_data_analysis';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../../_static/js/index.88dc4f4c5bd3676d55da.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-88310237-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Chris Holdgraf.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>