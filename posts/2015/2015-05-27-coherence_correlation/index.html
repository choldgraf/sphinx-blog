
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coherence vs. Correlation - a simple simulation &#8212; blog  documentation</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.e00ebc5fe59cde01733db895d987848c.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.88dc4f4c5bd3676d55da.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
  
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  
  <link rel="alternate" type="application/atom+xml"  href="../../../blog/atom.xml" title="Predictably Noisy">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../../../">
      <img src="../../../_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../about/">About me</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../projects/">Projects</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../publications/">Publications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../blog/">Blog</a>
        </li>
        
        
      </ul>


      <form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" >
</form>
      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/choldgraf/" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/choldgraf" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">
  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    27 May 2015
  
  </h2>

  <ul>
    

  

  

  

  
  <li id="category"><span><i class="fa-fw fa fa-folder-open"></i></span>
    
      
      <a href="../../../blog/category/neuroscience/">neuroscience</a>
      
    </li>
  

  
  <li id="tags"><span><i class="fa-fw fa fa-tags"></i>
      </span>
    
      
      <a href="../../../blog/tag/python/">python</a>
      
    
      
      <a href="../../../blog/tag/programming/">programming</a>
      
    
      
      <a href="../../../blog/tag/timeseries/">timeseries</a>
      
    
      
      <a href="../../../blog/tag/correlation/">correlation</a>
      
    </li>
  
  
  <li id="comments">
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'chrisholdgraf'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/posts/2015/2015-05-27-coherence_correlation/"> </a>
  </li>
  
  </ul>

  <h3><a href="../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../2020/2020-01-22-rst-thoughts/">22 January - What do people think about rST?</a></li>
    
      <li><a href="../../2019/2019-11-11-ipynb_pandoc/">11 November - Testing Pandoc and Jupyter Notebooks</a></li>
    
      <li><a href="../../2019/2019-10-27-jupyter-governance-python/">27 October - What would Python-style governance look like in Jupyter?</a></li>
    
      <li><a href="../../2019/2019-10-22-xarray-neuro/">22 October - Analyzing intracranial electrophysiology data with xarray</a></li>
    
      <li><a href="../../2019/2019-10-13-rust-jupyter-governance/">13 October - What would Rust-style governance look like in Jupyter?</a></li>
    
  </ul>

  <h3><a href="../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../blog/2020/">2020 (1)</a></li>
    
  
    
    <li><a href="../../../blog/2019/">2019 (8)</a></li>
    
  
    
    <li><a href="../../../blog/2018/">2018 (1)</a></li>
    
  
    
    <li><a href="../../../blog/2017/">2017 (3)</a></li>
    
  
    
    <li><a href="../../../blog/2016/">2016 (6)</a></li>
    
  
    
    <li><a href="../../../blog/2015/">2015 (4)</a></li>
    
  
  </ul>

          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#creating-our-sine-waves" class="nav-link">Creating our sine waves</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#computing-connectivity" class="nav-link">Computing connectivity</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#visualizing-results" class="nav-link">Visualizing results</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <p><em>Note - you can find the nbviewer of this post <a class="reference external" href="https://github.com/choldgraf/write-ups/blob/master/neuro/coherence_correlation.ipynb">here</a></em></p>
<div class="section" id="coherence-vs-correlation-a-simple-simulation">
<h1>Coherence vs. Correlation - a simple simulation<a class="headerlink" href="#coherence-vs-correlation-a-simple-simulation" title="Permalink to this headline">¶</a></h1>
<p>A big question that I’ve always wrestled with is the difference between correlation and coherence. Intuitively, I think of these two things as very similar to one another. Correlation is a way to determine the extent to which two variables covary (normalized to be between -1 and 1). Coherence is similar, but instead assesses “similarity” by looking at the similarity for two variables in frequency space, rather than time space.</p>
<p>There was a nice paper that came out a while back that basically compared these two methods in order to see when they’d produce the same result, when they’d produce different results, and when they’d break down [1]. They made a lot of nice plots like this:</p>
<img src='../../images/2015/eeg_coh.png' style='width:300px' /><p>Here I am recreating this result in the hopes of giving people a set of scripts to play around with, and giving a bit more intuition.</p>
<p>[1] http://www.ncbi.nlm.nih.gov/pubmed/8947780</p>
<hr class="docutils" />
<p>First things first, we’ll import some tools to use</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-our-sine-waves">
<h2>Creating our sine waves<a class="headerlink" href="#creating-our-sine-waves" title="Permalink to this headline">¶</a></h2>
<p>Recall that the equation for a sinusoidal wave is:</p>
<div class="math notranslate nohighlight">
\[ Asin(2{\pi}ft + 2\pi\phi)\]</div>
<p>Where <span class="math notranslate nohighlight">\(f\)</span> is the frequency of the wave, $<span class="math notranslate nohighlight">\(t\)</span><span class="math notranslate nohighlight">\( indexes time, and \)</span><span class="math notranslate nohighlight">\(2\pi\phi\)</span><span class="math notranslate nohighlight">\( defines a phase offset of the wave. Then, \)</span><span class="math notranslate nohighlight">\(A\)</span>$ scales the wave’s amplitude.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can generate these sine wave parameters, then stitch them together</span>
<span class="n">amplitude_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">phase_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">33</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>
<span class="n">freq</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">signal_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">amplitude_values</span><span class="p">,</span> <span class="n">phase_values</span><span class="p">))</span>
<span class="n">amps</span><span class="p">,</span> <span class="n">phases</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">signal_vals</span><span class="p">)</span>

<span class="c1"># We&#39;ll also define some noise levels to see how this affects results</span>
<span class="n">noise_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>

<span class="c1"># Now define how long these signals will be</span>
<span class="n">t_stop</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_stop</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>

<span class="c1"># We&#39;re storing everything in dataframes, so create some indices</span>
<span class="n">ix_amp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">amps</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;amp&#39;</span><span class="p">)</span>
<span class="n">ix_phase</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;phase&#39;</span><span class="p">)</span>

<span class="c1"># Create all our signals</span>
<span class="n">signals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">noise_level</span> <span class="ow">in</span> <span class="n">noise_levels</span><span class="p">:</span>
    <span class="n">sig_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">time</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">phase</span><span class="p">)</span> <span class="k">for</span> <span class="n">amp</span><span class="p">,</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">signal_vals</span><span class="p">])</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">noise_level</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">sig_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">sig_</span> <span class="o">+=</span> <span class="n">noise</span>
    <span class="n">ix_noise</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="n">noise_level</span><span class="p">]</span><span class="o">*</span><span class="n">sig_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span>
    <span class="n">ix_multi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([</span><span class="n">ix_amp</span><span class="p">,</span> <span class="n">ix_phase</span><span class="p">,</span> <span class="n">ix_noise</span><span class="p">])</span>
    <span class="n">signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sig_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">ix_multi</span><span class="p">))</span>
<span class="n">signals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">signals</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="computing-connectivity">
<h2>Computing connectivity<a class="headerlink" href="#computing-connectivity" title="Permalink to this headline">¶</a></h2>
<p>Now we’ve got a bunch of sinewaves with the parameters chosen above. Next, we will calculate the coherence and the correlation between all pairs of signals. This way we can see how these values change for different kinds of input signals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">con_all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ix_noise</span><span class="p">,</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;noise_level&#39;</span><span class="p">):</span>
    <span class="c1"># Setting up output indices</span>
    <span class="n">this_noise_level</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ix_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;amp==3 and phase==0&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ix_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">ix_cc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;cc&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">sig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>
    <span class="n">ix_coh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;coh&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">sig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>

    <span class="c1"># Calculating correlation is easy with pandas</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">ix_ref</span><span class="p">]</span>
    <span class="n">cc</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
    <span class="c1"># We&#39;ll use MNE for coherenece</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ix_ref</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">con</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">tapers</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">spectral_connectivity</span><span class="p">(</span>
        <span class="n">sig</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">sfreq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
    <span class="n">con_mn</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">con_mn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">con_mn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="c1"># Final prep</span>
    <span class="n">con_mn</span> <span class="o">=</span> <span class="n">con_mn</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">ix_coh</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">ix_cc</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">con_all</span> <span class="o">+=</span> <span class="p">([</span><span class="n">con_mn</span><span class="p">,</span> <span class="n">cc</span><span class="p">])</span>
<span class="n">con_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">con_all</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualizing-results">
<h2>Visualizing results<a class="headerlink" href="#visualizing-results" title="Permalink to this headline">¶</a></h2>
<p>First off, we’ll look at what happens to sine waves of varying parameters, for different levels of noise.</p>
<p>Remember, each tuple is (amplitude, phase_lag). The first number controls how large the signal is, and the second controls the difference in phase between two sine waves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">con_all</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;con&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Noise level: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">noise</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-05-27-coherence_correlation_9_0.png" src="../../../_images/2015-05-27-coherence_correlation_9_0.png" />
</div>
</div>
<p>That’s already an interesting picture - as you can see, coherence is far more robust to differences between the two signals. Here are a few thoughts:</p>
<ol class="simple">
<li><p>Correlation varies widely (between 0 and 1) for differences in phase lag. However, coherence remains relatively stable.</p></li>
<li><p>Coherence values are smaller in general for a signal with any noise</p></li>
<li><p>However, coherence is more robust for increasing levels of noise, while correlations start to drop to 0</p></li>
</ol>
<p>To illustrate number 1, let’s plot correlation and coherence against each other:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt_df</span> <span class="o">=</span> <span class="n">con_all</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;con&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;coh&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;noise_level&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CC vs Coherence&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-05-27-coherence_correlation_11_1.png" src="../../../_images/2015-05-27-coherence_correlation_11_1.png" />
</div>
</div>
<p>As you can see here, coherence remains the same (except for when it occasionally increases to 1) while correlation is much more dependent on the phase relationship between the signals. Moreover, as the signal SNR degrades, the correlation shrinks to 0, while the coherence remains the same.</p>
<p>Let’s take a look at how the correlation and coherence relate to the actual shape of the signals:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a dataframe for plotting</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="n">noise_levels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plt_df</span> <span class="o">=</span> <span class="n">con_all</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">plt_df</span> <span class="o">=</span> <span class="n">con_all</span><span class="p">[</span><span class="n">noise_level</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>

<span class="c1"># Define 16 signals to plot</span>
<span class="n">sig_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">([</span><span class="n">ix_ref</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span>

<span class="n">plt_sig</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">noise_level</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span>
<span class="n">n_combs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig_combinations</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_combs</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">n_combs</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">comp_a</span><span class="p">,</span> <span class="n">comp_b</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sig_combinations</span><span class="p">,</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="n">plt_sig</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="n">comp_a</span><span class="p">,</span> <span class="n">comp_b</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CC: </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">Coh: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">plt_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">comp_b</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-05-27-coherence_correlation_13_0.png" src="../../../_images/2015-05-27-coherence_correlation_13_0.png" />
</div>
</div>
<p>Another way of looking at it with scatterplots…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a dataframe for plotting</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="n">noise_levels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plt_df</span> <span class="o">=</span> <span class="n">con_all</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">plt_df</span> <span class="o">=</span> <span class="n">con_all</span><span class="p">[</span><span class="n">noise_level</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>

<span class="c1"># Define 16 signals to plot</span>
<span class="n">sig_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">([</span><span class="n">ix_ref</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span>

<span class="n">plt_sig</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">noise_level</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span>
<span class="n">n_combs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig_combinations</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_combs</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">n_combs</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">comp_a</span><span class="p">,</span> <span class="n">comp_b</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sig_combinations</span><span class="p">,</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="n">iia</span><span class="p">,</span> <span class="n">iib</span> <span class="o">=</span> <span class="n">plt_sig</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="n">comp_a</span><span class="p">,</span> <span class="n">comp_b</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">iia</span><span class="p">,</span> <span class="n">iib</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CC: </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">Coh: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">plt_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">comp_b</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-05-27-coherence_correlation_15_0.png" src="../../../_images/2015-05-27-coherence_correlation_15_0.png" />
</div>
</div>
<p>Finally, for a more direct comparison, we can look directly at the difference between the two as a function of both noise level and the sine wave parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_con</span> <span class="o">=</span> <span class="n">con_all</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">diff_con</span><span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">diff_con</span><span class="p">[</span><span class="s1">&#39;coh&#39;</span><span class="p">]</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;noise_level&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2015-05-27-coherence_correlation_18_1.png" src="../../../_images/2015-05-27-coherence_correlation_18_1.png" />
</div>
</div>
<p>So what does this mean? Well, the relationship between coherence and correlation is too complicated to sum it up in a single line or two. However, it is clear that correlation is more sensitive to differences between signals in time. Coherence, on the other hand, is more reliable for these differences. Moreover, correlation degrades quickly with an increase in noise, while coherence remains the same.</p>
<p>As such, if you care about understanding the relationship between two signals as it pertains to time, then perhaps correlation is the way to go. On the other hand, if you want a robust estimate of the amount of overlap in the structure of two signals, then coherence may be the best bet.</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../2015-08-30-craigslist_scrape/">
    Scraping craigslist
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  
  </span>
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'chrisholdgraf';
        var disqus_identifier = '/posts/2015/2015-05-27-coherence_correlation/';
        var disqus_title = 'Coherence vs. Correlation - a simple simulation';
        var disqus_url = 'https://predictablynoisy.com/posts/2015/2015-05-27-coherence_correlation';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../../_static/js/index.88dc4f4c5bd3676d55da.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-88310237-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Chris Holdgraf.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>